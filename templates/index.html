<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'style.css') }}">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <title>ISS Finder</title>
<style>
     #map {
        height: 930px; 
        width: 100%; 
       }
</style>
</head>
    
<input type="hidden" id="longitude" value="{{ iss_coordinates.longitude }}">
<input type="hidden" id="latitude" value="{{ iss_coordinates.latitude }}">

<h2>The ISS is right here right now</h2>
<div id="map"></div>

<script>
let map;
let markers = [];

function initMap() {
  const mapOptions = {
    lat: parseFloat(document.getElementById('latitude').value),
    lng: parseFloat(document.getElementById('longitude').value)
  };
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 3,
    center: mapOptions
  }); // This event listener will call addMarker() when the map is clicked.

  addMarker(mapOptions);
} // Adds a marker to the map and push to the array.

function addMarker(coords) {
    console.log(coords)
    const marker = new google.maps.Marker({
    position: coords,
    map: map,
    icon: 'static/issicon.png'
  });
  markers.push(marker);
} // Sets the map on all markers in the array.

function setMapOnAll(map) {
  for (let i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  }
} // Removes the markers from the map, but keeps them in the array.

function clearMarkers() {
  setMapOnAll(null);
} // Shows any markers currently in the array.


function deleteMarkers() {
  clearMarkers();
  markers = [];
}


setInterval(() => {
    $.ajax({
        type: "GET",
        url: "/api/iss",
        success: function(data) {
            deleteMarkers();
            addMarker({lat: parseFloat(data.latitude), lng: parseFloat(data.longitude)})
        }
    });

}, 2000);
    </script>
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSF8vxGAb31VE2avrZ0i6_MDl_SYGB9_U&callback=initMap"></script>
</body>
</html>